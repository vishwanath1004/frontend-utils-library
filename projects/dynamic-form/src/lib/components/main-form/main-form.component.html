<form [formGroup]="myForm" [class]="classFlex">
  <div *ngFor="let control of formJson" class="w-full">
    <mat-form-field
      *ngIf="control?.type === 'text' || control?.type === 'password'"
      floatLabel="always"
    >
      <mat-label *ngIf="control.label">{{ control?.label | languageTranslate: language }}</mat-label>
      <input
        matInput
        [placeholder]="control?.placeHolder | languageTranslate: language"
        [type]="control?.type"
        [formControlName]="control?.name"
        [maxlength]="control?.validators.maxLength"
        [required]="control?.validators?.required"
      />
      <mat-icon
        matSuffix
        *ngIf="control?.type === 'password' || control?.showPasswordIcon"
        (click)="togglePasswordVisibility(control)"
        style="cursor: pointer"
      >
        {{ control?.type === "password" ? "visibility_off" : "visibility" }}
      </mat-icon>        
    </mat-form-field>

    <mat-form-field *ngIf="control?.type === 'textarea'" floatLabel="always" >
      <mat-label *ngIf="control.label">{{ control?.label | languageTranslate: language }}</mat-label>
      <textarea
        matInput
        [formControlName]="control?.name"
        [placeholder]="control?.placeHolder | languageTranslate: language"
        [maxlength]="control?.validators?.maxLength"
        [required]="control?.validators?.required"
      >
      </textarea>
    </mat-form-field>

    <mat-form-field *ngIf="control?.type === 'select'" floatLabel="always">
      <mat-label *ngIf="control.label">{{ control?.label | languageTranslate: language }}</mat-label>
      <mat-select
        [value]="control?.value"
        [placeholder]="control?.placeHolder | languageTranslate: language"
        [formControlName]="control?.name"
        [required]="control?.validators?.required"
        [compareWith]="compareWith"
      >
        <mat-option *ngFor="let option of control?.options" [value]="option">
          {{ option.label }}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field *ngIf="control?.type === 'chip'" floatLabel="always">
      <mat-label *ngIf="control.label">{{ control?.label | languageTranslate: language }}</mat-label>
      <lib-chip-input
        [chipControl]="control"
        [formControlName]="control?.name"
      ></lib-chip-input>
      <textarea
        matInput
        [formControlName]="control?.name"
        hidden
        [required]="control?.validators?.required"
      ></textarea>
    </mat-form-field>

    <mat-form-field *ngIf="control?.type === 'range'" floatLabel="always">
      <mat-label *ngIf="control.label">{{ control?.label | languageTranslate: language }}</mat-label>
      <mat-slider
        style="width: 100%"
        [min]="control?.min"
        [max]="control?.max"
        [step]="control?.step"
        [discrete]="control?.showThumbLabel"
      >
      <input matSliderThumb [formControlName]="control?.name" [value]="control?.value">
      </mat-slider>
      <textarea matInput [formControlName]="control?.name" hidden></textarea>
    </mat-form-field>

    <mat-form-field *ngIf="control?.type === 'rating'" floatLabel="always">
      <mat-label *ngIf="control.label">{{ control?.label | languageTranslate: language }}</mat-label>
      <lib-star-rating
        [formControlName]="control.name"
        [label]="control.label"
        [starsCount]="control.noOfstars"
      ></lib-star-rating>
      <textarea matInput [formControlName]="control?.name" hidden></textarea>
    </mat-form-field>

    <mat-form-field *ngIf="control?.type === 'checkbox'" floatLabel="always">
      <mat-label *ngIf="control.label">{{ control?.label | languageTranslate: language }}</mat-label>
      <input matInput [formControlName]="control?.name" hidden />
      <lib-checkbox-input
        [checkboxControl]="control"
        [formControlName]="control?.name"
      ></lib-checkbox-input>
    </mat-form-field>

    <mat-form-field *ngIf="control?.type === 'radio'" floatLabel="always">
      <mat-label *ngIf="control.label">{{ control?.label | languageTranslate: language }}</mat-label>
      <input matInput [formControlName]="control?.name" hidden />
      <lib-radio-input
        [radioControl]="control"
        [formControlName]="control?.name"
      ></lib-radio-input>
    </mat-form-field>

    <mat-form-field *ngIf="control?.type == 'toggle'" floatLabel="always">
      <mat-label *ngIf="control.label">{{ control?.label | languageTranslate: language }}</mat-label>
      <mat-slide-toggle
        [formControlName]="control?.name"
        [checked]="control?.value"
        [required]="control?.validators?.required"
        color="primary"
      >
      </mat-slide-toggle>
      <textarea
        matInput
        [formControlName]="control?.name"
        hidden
        [required]="control?.validators?.required"
      ></textarea>
    </mat-form-field>

    <mat-form-field *ngIf="control?.type == 'subFields'" floatLabel="always">
      <mat-label *ngIf="control.label">{{ control?.label | languageTranslate: language }}</mat-label>
      <div>
        <dynamic-form [formJson]="control.subfields" classFlex="flex-class" #subform (change)="addFields(control?.name, $event)" [language]="language" ></dynamic-form>
      </div>
      <textarea
        matInput
        [formControlName]="control?.name"
        hidden
        [required]="control?.validators?.required || this.subform?.myForm?.invalid"
      ></textarea>
    </mat-form-field>

    <mat-form-field *ngIf="control?.type == 'addResource'" floatLabel="always" appearance="fill" class="no-bottom-line">
      <mat-label *ngIf="control.label">{{ control?.label | languageTranslate: language }}</mat-label>
      <div class="flex cursor-pointer flex-class" (click)="onClickAddResource(control)">
        <mat-icon>{{control.icon}}</mat-icon>
        <p>{{control?.textForLink}}</p>
      </div>
      <div class="flex flex-col gap-4">
        <div  *ngFor="let resource of this.resources;let i = index" class="flex gap-4 bg-gray-200">
          <mat-icon>{{control.listIcon}}</mat-icon>
          <p>{{control.listLabel}}</p>
          <mat-icon (click)="deleteResource(i,control?.name)" class="cursor-pointer">close</mat-icon>
        </div>
      </div>
      <textarea
        matInput
        [formControlName]="control?.name"
        hidden
        [required]="control?.validators?.required"
      ></textarea>
    </mat-form-field>

    <mat-error
      *ngIf="
        myForm.get(control?.name)?.touched &&
        myForm.get(control?.name)?.invalid
      "
    >
      <div
        class="error-message"
        *ngIf="
          control?.errorMessage[
            ((myForm.get(control.name)?.errors | keyvalue) || [])[0].key
          ];
          else genericErrorMessage
        "
      >
        <mat-icon class="error-icon" matPrefix>error_outline</mat-icon>
        {{
          control?.errorMessage[
            ((myForm.get(control.name)?.errors | keyvalue) || [])[0].key
          ] | languageTranslate: language
        }}
      </div>
      <ng-template #genericErrorMessage>
        <div class="error-message">
          <mat-icon class="error-icon" matPrefix>error_outline</mat-icon>
          Enter {{ control?.label | languageTranslate: language }}
        </div>
      </ng-template>
    </mat-error>
  </div>
</form>